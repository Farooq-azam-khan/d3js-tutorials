<!DOCTYPE html>

<html>
  <head>
    <title>D3JS tutorial</title>
    <!-- favicon -->
    <link rel='icon' href='./favicon/favicon.ico' type='image/x-icon'/ >
    <!-- fonts -->
    <!-- baskerville -->
    <link
      href="https://fonts.googleapis.com/css?family=Baskervville&display=swap"
      rel="stylesheet"
    />
    <!-- ubuntu sans-serif -->
    <link
      href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap"
      rel="stylesheet"
    />
    <!-- ibm plex mono -->
    <link
      href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono&display=swap"
      rel="stylesheet"
    />

    <!-- 3rd party css -->
    <!-- highlight -->
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/default.min.css"
    />
    <!-- custom styles -->
    <link rel="stylesheet" href="css/d3_styles.css" />
    <link rel="stylesheet" href="css/generic_styles.css" />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <div id="app" class="container">
      <h1>D3 Tutorial</h1>
      <div class="row">
        <h2>Working with Javascript</h2>
        <p>We have the following data of cars</p>
        <figure>
        <pre class="json"><code id="carsData"></code></pre>
      <figcaption>List of Cars</figcaption>
      </figure>
        <p>We can use functional programming to make it look nicer. 
          The code below use a functional paradigm. 
          By making a <code>reduce</code> function we can easily format json formatted data. </p> 
          <figure>
            <pre class="js"><code >data.reduce((acc, d) => {
  acc += formatCar(d) + "\n";
  return acc;
}, "");
export const formatCar = car =>
  `${car.year} ${car.make} ${car.model}: ${car.price}`;</code></pre>
            <figcaption>Reduce Function</figcaption>
          </figure>
        <figure>
          <pre class="json"><code id="formatCar"></code></pre>
          <figcaption>Use of Reduce function</figcaption>
        </figure>
        <p>
          This is done by mapping over the data with a custom function that
          formats each object (i.e. each car description). Look at
          <span class="file-reference">components/car.js</span> file for the
          formatting function.
        </p>
        <p>
          We can also filter by a specific price. In the following example we
          filter by car prices less than $2000.
        </p>

        <figure>
          <pre class="js"><code>export const filterByPrice = (cars, price) =>
            cars.filter(car => car.price &lt; price);</code></pre>
        <figcaption>Here is the code for the filter method.</figcaption>
      </figure>
        <figure>
        <pre class="json"><code id="filterCarPrice"></code></pre>
          <figcaption> Result of applying the filter method used here</figcaption>
      </figure>
      </div>
      <!-- end of row 1 -->

      <div class="row">
        <h2>HTML CSS and SVG</h2>
        <p>
          We can write scalable vector graphics (SVG) using the svg tag. Learn
          the follwoing:
        </p>
        <ol>
          <li>
            height and width of the svg tag (defined it here as height="520" and
            width="100%" (of its parent i.e. the .row class);
          </li>
          <li>
            circle tag which takes in cx, cy and r all self explanitory;
          </li>
          <li>
            Same goes for the rect tag which takes in x, y, width, and height;
          </li>
          <li>
            the group element which applies a tranformation, fill, stroke, etc.
            to all its children element. These children elements can be any tag
            (circle, rectangle, or path);
          </li>
          <li>
            lastly the path where the d attribute is the most important. It can
            any polygon you desire. It requires a start point M x,y. Then a line
            to a desired point: L x2,y2. These L points can be grouped n times.
          </li>
        </ol>
        <svg height="520">
          <circle r="100" cx="100" cy="100"></circle>
          <rect x="250" y="0" width="100" height="200"></rect>

          <circle r="100" cx="100" cy="350" fill="#fabfab"></circle>
          <rect x="250" y="250" width="100" height="200" fill="#fabfab"></rect>

          <g fill="#2afbaf" stroke="#345345">
            <circle r="100" cx="500" cy="100" stroke-width="2"></circle>
            <rect x="650" y="0" width="100" height="200"></rect>
          </g>
          <line
            x1="380"
            y1="0"
            x2="380"
            y2="520"
            stroke="red"
            stroke-weight="3"
          ></line>

          <path
            stroke="orange"
            stroke-width="3"
            fill="none"
            d="M 0,220 L 900,220 L 900,510 L 380,510 L 900, 220"
          ></path>
          <path
            stroke="orange"
            stroke-width="3"
            fill="#ab5ab5"
            d="M 900,220 L 900,510 L 380,510 L 900,220"
          ></path>
        </svg>
      </div>
      <!-- end of row 2-->
      <div class="row">
        <h2>Using d3</h2>
        <p>We can see that the above can be replicated with d3.js.</p>
        <svg id="d3-test"></svg>
      </div>
      <!--end of row 3-->
      <div class="row">
        <h2>Making a face with d3.js</h2>
        <p>
          Will demostrate how to make a face and will see it below. We can also
          do animation with d3. For a demo click the "Start Animation" button.
        </p>
        <button id="face-animation-btn">Start Animation</button>
        <svg id="face"></svg>
        <p>Explination to be done.</p>
      </div>
      <!-- end of row 4-->

      <div class="row">
        <h2>Making a Bar Chart</h2>
        <p>
          Got the data from here:
          <a
            target="_blank"
            href="https://population.un.org/wpp/Download/Standard/Population/"
            >UN Data</a
          >
        </p>
        <svg id="barchart-population"></svg>
      </div>
      <!-- end of row 5-->
      <div class="row">
        <h2>Drawing a Scatterplot</h2>
        <p>Here we will draw a scatterplot</p>
        <svg id="scatterplot"></svg>
        <p>Here is another scatter plot where both x and y are numeric.</p>
        <svg id="cars-scatter-plot"></svg>
        <p>Another scatter plot here with temperature.</p>
        <svg id="temperature-scatter-plot"></svg>
      </div>
      <!-- end of row 6-->
      <div class="row">
        <h2>Lineplots</h2>
        <p>Let us do line plots now</p>
        <p>Here are some options you can play with:</p>
        <button id="show-points">Toggle Points</button>
        <button id="show-fill">Toggle Fill</button>
        <svg id="lineplot-temp"></svg>
      </div>
      <!-- end of row 7 -->
      <div class="row">
        <h2>Area Plot</h2>
        <p>Let us do area plot now</p>
        <button id="show-stroke">Toggle Stroke</button>
        <!-- Rounded switch -->
        <!-- <label class="switch">
          <input id="toggle" type="checkbox" />
          <span class="slider round"></span>
        </label> -->
        <button id="show-points-areaplot">Toggle Points</button>
        <p>
          Change the size of the strok when show.
          <input
            type="number"
            value="2"
            placeholder="stroke weight"
            id="adjust-stroke-weight-area-temp"
          />
        </p>

        <svg id="area-temp"></svg>
        <h3>Area with Baseline</h3>
        <p>
          The baseline is an important property of an area plot. In the above
          lineplot example the temperature baseline was 14 but that is not a
          correct implementation of an area plot.
        </p>
        <p>
          Below let us plot a proper area graph.
        </p>
        <svg id="area-population"></svg>
      </div>
      <!-- end of row 8 -->
      <div class="row">
        <h2>General Update Pattern: Enter, Update, Remove</h2>
        <p>
          This section will demonstrate how the enter, update, and remove work
          with a bowl of fruit example.
        </p>
        <p>
          If the bowl is empty then add 5 apples. If you eat one remove it from
          the bowl.
        </p>
        <button id="bowl-animation">Start Animation</button>

        <svg id="bowl-of-fruit"></svg>

        <h3>Nested Elements with the General Update Pattern</h3>
        <button id="general-pattern-bowl-animation">Start Animation</button>
        <svg id="nested-bowl-of-fruit"></svg>
        <p>
          You can add only one element (like the bowl) by using the
          <pre class="js">
          <code
            >selection.selectAll('rect').data([null]).enter().append('rect')</code
          ></pre>.
        </p>
      </div>
      <!-- end of row 9-->
      <div class="row">
        <h2>Interaction with Unidirectional Dataflow</h2>
        <p>Who knew you could interaction with data. Here we will see that.</p>
        <svg id="interaction"></svg>
      </div>
      <!--end of row 10-->
      <div class="row">
        <h2>Making a Map with d3</h2>
        <p>Lets make a map.</p>
        <ul>
          <li>Loading and parsing TOPJSON;</li>
          <li>Rendering geopraphic features;</li>
          <li>Using different map projections;</li>
          <li>Rendering projected shpere outline.</li>
        </ul>
        <p>Here are some references used here:</p>
        <ul>
          <li>
            <a target="_blank" href="https://www.npmjs.com/package/world-atlas"
              >world-atlas npm</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://www.jsdelivr.com/package/npm/world-atlas"
              >CDN for topjson</a
            >
            or
            <a
              target="_blank
              "
              href="https://unpkg.com/world-atlas@1.1.4/world/110m.json"
              >I used</a
            >
          </li>
          <li>
            <a target="_blank" href="https://observablehq.com/@d3/world-map-svg"
              >d3 geo</a
            >
          </li>
          <li>
            <a
              target="_blank"
              href="https://unpkg.com/topojson@3.0.2/dist/topojson.min.js"
              >Block builder</a
            >
            website to search for ideas for maps
          </li>
        </ul>
        <p>
          Loaded topo json format and d3 requires geo json format. Thus use
          topojson library for conversion. Got the topojson library from here:
          <a href="https://unpkg.com/topojson@3.0.2/dist/topojson.min.js"
            >TopoJSON Library</a
          >.
        </p>
        <p>
          Use the <code>topojson.feature(data)</code> function for conversion.
        </p>

        <p>
          If the path type is sphere then you will get the thick borders around
          the map.
        </p>
        <svg id="map-beg"></svg>
        <pre><code class="js">export const createMapBeg = () => { 
  const svg = d3.select("#id");
  // type of projection
  const projection = d3.geoMercator(); 
  // path generator ie the d=""
  const pathGenerator = d3.geoPath().projection(projection); 
  d3.json("https://unpkg.com/world-atlas@1.1.4/world/110m.json")
    .then(data => {
          const countries = topojson
                  .feature(data, data.objects.countries);
          const paths = svg.selectAll("path").data(countries.features); 
          paths.enter() .append("path") .attr("d", d => pathGenerator(d)); 
  }); 
};</code></pre>
        <h3>Making some tweaks to the map</h3>

        <p>
          You will find the types of projections here:
          <a href="https://github.com/d3/d3-geo-projection" target="_blank"
            >Projections</a
          >,
          <a href="https://github.com/d3/d3-geo" target="_blank">
            another link</a
          >.
        </p>
        <p>Here is a list of some projections</p>
        <ul>
          <li>
            <span class="js"><code>d3.geoOrthographic();</code> </span>
            This is used below.
          </li>
          <li>
            <span class="js"><code>d3.geoStereographic();</code></span>
          </li>
          <li>
            <span class="js"><code>d3.geoEqualEarth();</code></span>
          </li>
          <li>
            <span class="js"><code>d3.geoGnomonic();</code></span>
          </li>
        </ul>
        <svg id="map-tweaks"></svg>
        <p>
          Need to figure out how to resize maps properly, and also how to rotate
          them.
        </p>

        <h3>Map Interaction</h3>
        <p>
          Who knew we could interact with maps. Try to hover over them countries
          in the following map.
        </p>
        <svg id="map-interaction"></svg>
      </div>
      <!-- end of section 11-->
      <div class="row">
        <h2>Tree Visualization</h2>
        <p>We will create a tree. Uses the d3.hierarchy library. It is there by default.</p>
        <svg id="tree-country"></svg>
        <svg id="tree-country-2"></svg>
        <p>You could use <code class="js">treeLayout = d3.cluster()</code> if the 
        leaft nodes are unlevel to have them appear on the same level.</p>
        <p>You can also have vertical trees with the following code: </p>
        <figure>
<pre class="js"><code>const treeRoot = d3.hierarchy(data);
  const links = treeLayout(treeRoot).links();
  const linkPathGenerator = d3
    .linkHorizontal() //.linkVertical()
    .x(d => d.y)
    .y(d => d.x);
</code></pre>
          <figcaption>vertical tree code</figcaption>
        </figure>

      </div><!--end of section 12-->
    </div>
    <!-- end of container-->
    <!-- hljs -->
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <!-- topoJSON -->
    <script src="https://unpkg.com/topojson@3.0.2/dist/topojson.min.js"></script>
    <!-- d3 js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.14.2/d3.min.js"></script>
    <!-- d3 geo projections -->
    <script src="https://d3js.org/d3-array.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    
    <script type="module" src="js/state.js"></script>
    <script type="module" src="index.js"></script>
    <script type="module" src="js/button_logic.js"></script>

  </body>
</html>
